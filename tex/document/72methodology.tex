\section{Momentum Equilibrium and Elbow Angle Optimization}
\label{sec:72methodology}

\minitoc{70mm}{4}

\noindent
In this section, we give an overview of the methodology of our approach.
We closely follow the presentation of \cite{Valentin18Gradient}.



\subsection{From Muscle Forces to Equilibrium Angles}
\label{sec:721equilibrium}

\paragraph{Model inputs and outputs}

In the following, we regard simulations of the
human upper limb model described in \cref{sec:71model} as a black box.
This black box receives as its input
the elbow angle $\elbang \in \clint{\ang{10}, \ang{150}}$
and the activation parameters $\actT, \actB \in \clint{0, 1}$
of triceps and biceps.%
\footnote{%
  Here and in the following, the subscripts T, B, and L stand for
  triceps, biceps, and load, respectively.%
}
The outputs of the black box simulation are the forces
$\forceT(\elbang, \actT)$ and $\forceB(\elbang, \actB)$
that triceps and biceps exert.
These forces depend on the elbow angle as well as on the respective
activation parameter.
Gravitational forces due to the masses of bones or masses
are neglected in this context.
However, we allow the specification of an external load $\forceL$
applied to the end of the forearm.
This load may the weight force of some object
that the arm is supposed to keep in position.

\paragraph{Moments and lever arms}

Every force exerts a \term{moment} (or \term{torque}) on the elbow joint.
The moments are the products of the forces $\forcevalue_\ast$
with the respective lever arms $\arm_\ast$
($\ast \in \{\mathrm{T}, \mathrm{B}, \mathrm{L}\}$).
The lever arms are approximated as in
\multicite{Roehrle16Two,Valentin18Gradient} by using
the tendon-displacement method of \cite{An84Determination},
resulting in
\begin{subequations}
  \begin{align}
    \armT(\elbang)
    &:= (-0.0009399 \{\elbang\}^2 + 0.1126 \{\elbang\} + 22.21)\;
    \si{\milli\meter},\\
    \armB(\elbang)
    &:= (-0.001482 \{\elbang\}^2 + 0.1776 \{\elbang\} + 35.02)\;
    \si{\milli\meter},\\
    \armL(\elbang)
    &:= \sin(\elbang) \cdot \SI{282.5}{\milli\meter},
  \end{align}
\end{subequations}
where $\{\elbang\}$ denotes the numerical value of $\elbang$
in degrees.
The lever arms are non-negative and the forces are signed, i.e.,
positive forces pull the forearm downwards,
negative forces pull it upwards.
In general, $\forceT, \forceL \ge \SI{0}{\newton}$ and
$\forceB \le \SI{0}{\newton}$.

\paragraph{Total moment and equilibrium elbow angle}

The \term{total moment} of the system is given by the function
\begin{subequations}
  \begin{gather}
    \moment_{\forceL,\actT,\actB}\colon
    \clint{\ang{10}, \ang{150}} \to \real,\\
    \moment_{\forceL,\actT,\actB}(\elbang)
    := \forceT(\elbang, \actT) \armT(\elbang) +
    \forceB(\elbang, \actB) \armB(\elbang) +
    \forceL \armL(\elbang),
  \end{gather}
\end{subequations}
cf.\ \cite{Valentin18Gradient}.
The system is in \term{equilibrium,}
if the total moment vanishes, i.e.,
$\moment_{\forceL,\actT,\actB}(\elbang) = \SI{0}{\newton\meter}$.
We call the corresponding angle $\elbang$ the
\term{equilibrium elbow angle.}
To find this angle for a given load $\forceL$ and activation parameters
$\actT$ and $\actB$, we first note that
$\moment_{\forceL,\actT,\actB}$ may have zero, exactly one,
or multiple zeros in $\clint{\ang{10}, \ang{150}}$.
Hence, the inverse function evaluated at $\SI{0}{\newton\meter}$
is partially defined depending on load and activation parameters:
\begin{subequations}
  \begin{gather}
    \elbang_{\forceL}\colon \actdomain{\forceL} \to
    \clint{\ang{10}, \ang{150}},\quad
    \actdomain{\forceL} \subset \clint{0, 1}^2,\\
    \elbang_{\forceL}(\actT,\actB)
    := (\moment_{\forceL,\actT,\actB})^{-1}(\SI{0}{\newton\meter}),
  \end{gather}
\end{subequations}
which is well-defined whenever $\moment_{\forceL,\actT,\actB}$
has a unique root.
We approximate $\elbang_{\forceL}(\actT,\actB)$ with the Newton method
\multicite{Roehrle16Two,Valentin18Gradient}:
\begin{equation}
  \elbang^{(j+1)}
  := \elbang^{(j)} -
  \frac{
    \moment_{\forceL,\actT,\actB}(\elbang^{(j)})
  }{
    \partialderiv{\partialdiff{} \elbang}{\moment_{\forceL,\actT,\actB}}
    (\elbang^{(j)})
  },\quad
  j \in \nat,
\end{equation}
with an initial value
$\elbang^{(0)} \in \clint{\ang{10}, \ang{150}}$
and the stopping criterion of
$\abs{\moment_{\forceL,\actT,\actB}(\elbang^{(j)})} <
\SI{e-9}{\newton\meter}$ or
$\abs{\partialderiv{\partialdiff{} \elbang}{\moment_{\forceL,\actT,\actB}}
(\elbang^{(j)})} < \SI{e-9}{\newton\meter\per\degree}$.
We repeat the Newton method for the initial values
$\elbang^{(0)} = \ang{80}, \ang{40}, \ang{120}$
and use the first converged result
(i.e., we check if $\elbang^{(0)} = \ang{80}$ converges;
if not, proceed with $\elbang^{(0)} = \ang{40}$, and so on).
If all three initial values do not converge,
we conclude that $(\actT, \actB) \notin \actdomain{\forceL}$.



\subsection{Optimization Problems}
\label{sec:722optimization}

\paragraph{General task}

The general task in our setting is as follows:
For a given external load $\forceL$ and a target elbow angle $\elbang^\ast$,
find activation parameters $(\actT, \actB) \in \clint{\*0, \*1}$
such that the target elbow angle is attained in the equilibrium,
i.e., $\elbang_{\forceL}(\actT,\actB) = \elbang$.
Example applications of such a scenario are medicine and robotics,
when a specific movement should be carried out.

\paragraph{List of optimization problems}

However, as discussed in \cref{sec:711models},
musculoskeletal systems with an antagonistic muscle pair,
such as our human upper limb model, are usually overdetermined.
This means that there are multiple solutions to this problem.
To solve this issue, one may solve one of the three
optimization problems that the following list proposes
\cite{Valentin18Gradient}:

\begin{enumerate}[label=O\arabic*.,leftmargin=2.7em]
  \item
  For a given external load $\forceL$ and a target angle
  $\elbang^\ast \in \clint{\ang{10}, \ang{150}}$,
  find the activation parameters $(\actT, \actB) \in \clint{\*0, \*1}$
  such that $\actT + \actB$ is minimized under the constraint
  $\elbang_{\forceL}(\actT, \actB) = \elbang^\ast$.
  
  \item
  For a given external load $\forceL(t_2)$ for a time $t_2 > t_1$,
  a target angle $\elbang^\ast(t_2) \in \clint{\ang{10}, \ang{150}}$,
  and initial activation parameters
  $(\actT(t_1), \actB(t_1)) \in \clint{\*0, \*1}$,
  find new activation parameters
  $(\actT(t_2), \actB(t_2)) \in \clint{\*0, \*1}$ such that
  $(\actT(t_2) - \actT(t_1))^2 + (\actB(t_2) - \actB(t_1))^2$
  is minimized under the constraint
  $\elbang_{\forceL(t_2)}(\actT(t_2), \actB(t_2)) = \elbang^\ast(t_2)$.
  
  \item
  For a given external load $\forceL(t_2)$ for a time $t_2 > t_1$,
  an initial angle $\elbang^\ast(t_1) \in \clint{\ang{10}, \ang{150}}$,
  an initial activation parameters
  $(\actT(t_1), \actB(t_1)) \in \clint{\*0, \*1}$,
  find new activation parameters
  $(\actT(t_2), \actB(t_2)) \in \clint{\*0, \*1}$ such that
  $(\actT(t_2) - \actT(t_1))^2 + (\actB(t_2) - \actB(t_1))^2 +
  c^2 \cdot (
    \elbang_{\forceL(t_2)}(\actT(t_2), \actB(t_2)) - \elbang^\ast(t_2)
  )^2$ is minimized (with $c \in \nonnegreal$ arbitrary but fixed).
\end{enumerate}

\paragraph{Motivation of problem O1}

The motivation of all problems is that the human body tries to
achieve a given movement with minimal energy effort.
For the first problem O1, this effort is quantified by $\actT + \actB$,
i.e., the energy effort for each muscle is assumed to be proportional
to its activation parameter.

\paragraph{Motivation of problem O2}

The second problem O2 is motivated as follows:
Before time $t = t_1$, the musculoskeletal system is in equilibrium for
an external load $\forceL(t_1)$,
activation parameters $\actT(t_1), \actB(t_1)$, and
elbow angle $\elbang^\ast(t_1)$, i.e.,
$\moment_{\forceL(t_1),\actT(t_1),\actB(t_1)}(\elbang^\ast(t_1))
= \SI{0}{\newton\meter}$.
Directly after $t = t_1$,
the external force and/or the target angle is suddenly changed
to $\forceL(t_2)$ and $\elbang^\ast(t_2)$, respectively.
Consequently, triceps and biceps adapt their activation parameters
such that the musculoskeletal system returns to equilibrium
at some time $t = t_2 > t_1$.
Hence, we have to determine the new activation parameters
$\actT(t_2), \actB(t_2)$ such that
$\moment_{\forceL(t_2),\actT(t_2),\actB(t_2)}(\elbang^\ast(t_2))
= \SI{0}{\newton\meter}$.

TODO

\paragraph{Motivation of problem O3}

TODO



\subsection{B-Spline Surrogates on Sparse Grids}
\label{sec:723surrogates}

\todo{talk about sparse grids}
\todo{talk ``only'' about two dimensions}
\todo{talk about derivatives (14)}

\dummytext[3]{}
