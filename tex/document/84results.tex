\section{Implementation and Numerical Results}
\label{sec:84results}

\minitoc[11.5mm]{65mm}{6}

\parbox{1em}{}
\vspace{-3em}



\printornamentsfalse
\subsection{Implementation}
\printornamentstrue

\paragraph{Parameter values and basis functions}

We use
a risk aversion factor of $\riskav = 3.5$,
a patience factor of $\patience = 0.97$,
a transaction cost rate of $\tac = \SI{1}{\percent}$, and
a minimum consumption of $\normconsume_{\min} = 0.001$.
The bond and stock return rates are taken from \cite{Cai10Stable}.
The models are solved for $T = 6$ time steps;
this number suffices to show all relevant numerical effects and results,
while keeping the computational effort at a reasonable level.
As higher-order B-spline basis functions,
we use the hierarchical weakly fundamental not-a-knot splines
$\bspl[\wfs,\nak]{\*l,\*i}{p}$ of cubic degree $p = 3$
to enable hierarchization with the unidirectional principle.

\vspace*{-0.5em}

\paragraph{Software}

The dynamic portfolio choice models were solved using a self-written
MATLAB framework.
The object-oriented framework was designed in such a way that
not only transaction costs problems,
but many other types of dynamic portfolio choice models can be handled.
For instance, the base class \texttt{LifecycleProblem} provides
an interface with abstract functions such as
\texttt{computeTerminalValueFunction} and
\texttt{computeStateTransition}.
The actual functionality implemented in the base class strongly resembles
the algorithms presented in \cref{sec:82algorithms}.
This is not only desirable from a modeling perspective,
but also facilitates future usage by other researchers.
For creating (hierarchization) and evaluating sparse grid interpolants,
the sparse grid toolbox \sgpp was used \cite{Pflueger10Spatially}.%
\footnote{%
  \url{http://sgpp.sparsegrids.org/}%
}
The emerging optimization problems were solved using
sequential quadratic programming methods supplied by the
NAG Toolbox for MATLAB.%
\footnote{%
  \url{https://www.nag.com/}%
}
Runtimes were measured on a shared memory computer
with 144 threads on 4x Intel Xeon E7-8880v3 (72 cores, 144 threads).



\subsection{Numerical Results}

\paragraph{Error measures and reference solution}

To assess the quality of the resulting value and policy functions,
we use two error measures:
Euler equation error and reference solution error.
The Euler equation error $\error_t(\normstate_t)$
measures the violation of the first-order optimality conditions,
derived as above.
The reference solution error is the difference
$\normcetvalueref_t(\state_t) - \normcetvalueintp_t(\state_t)$
of the value function to some reference or
$\optnormpolicyref_t(\state_t) - \optnormpolicyintp_t(\state_t)$
of the optimal policy.
Both error measures can be analyzed pointwise or
via their $\Ltwo$ or $\Linfty$ norms.
%(the reference solution errors are relative).
If we omit the time subscript $t$,
then we additionally take the mean over all times $t = 0, \dotsc, T - 1$
(e.g., $
  \normLtwo{\error} := \frac{1}{T} \sum_{t=0}^{T-1} \normLtwo{\error_t}
$).

We use full grid solutions as reference solutions,
i.e., $\{\state_t^{(k)} \mid k = 1, \dotsc, \ngp_t\} = \fgset{n,d}$
for some fixed level $n \in \nat$ for all $t = 0, \dotsc, T$.
Obviously, this is only computationally feasible
for low dimensionalities $d$ due to the curse of dimensionality.
The one-dimensional reference solution has level $n = 11$
($\ngp_t = \num{2049}$, runtime \hms{;17}) and
mean Euler equation error of
$\normLtwo{\error} \approx \num{6.50e-9}$.
The two-dimensional reference solution has level $n = 7$
($\ngp_t = \num{16641}$, runtime \hms{9;33}) and
mean Euler equation error of
$\normLtwo{\error} \approx \num{4.78e-4}$.
In three dimensions, only a reference solution of level $n = 4$
($\ngp_t = \num{4913}$, runtime \hms{4;2}) and
mean Euler equation error of
$\normLtwo{\error} \approx \num{1.76e-2}$ could be computed
(with a large maximum error of $\normLinfty{\error} \approx \num{0.112}$).
The next-level solution would already have almost \num{36000} grid points
and take over a week to compute.
Therefore, only the reference solutions for $d = 1$ and $d = 2$
are sufficiently accurate.

\paragraph{Solution on regular sparse grids}

\dummytext[5]{}

\paragraph{Comparison with piecewise linear functions}

\dummytext[5]{}

\paragraph{Solution on spatially adaptive sparse grids}

\dummytext[5]{}

\paragraph{Monte Carlo simulation}

% certainty-equivalent consumption
% mit B-splines und linearen Funktionen

\dummytext[5]{}
