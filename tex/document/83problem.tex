\section{Transaction Costs Model}
\label{sec:83problem}

\minitoc{70mm}{3}

\noindent
This section defines the transaction costs model as an example problem for
dynamic portfolio choice models.



\subsection{Unnormalized Problem}
\label{sec:831unnormalized}

\paragraph{Description}

In the \term{transaction costs model} \cite{Schober18Solving},
the individual can invest their money risk-free in bonds
(with a fixed interest rate similar to a bank account)
or in $m_{\stock} \in \nat$ different stocks, which is risk-affected.
Every stock transaction,
i.e., buy $\buy_{t,j}$ or sell $\sell_{t,j}$,
inflicts transaction costs $\tac \buysell_{t,j}$ ($\tac \in \nonnegreal$)
proportional to the amount $\buysell_{t,j}$ that was bought or sold
($j = 1, \dotsc, m_{\stock}$).
The individual only wants to invest a fixed
amount $\wealth_0$ in stocks, i.e., we omit the individual's income.

\paragraph{Consumption and state transition}

In the following,
$\stock_{t,j}$ denotes the fraction of the total wealth $\wealth_t$
that is invested in the $j$-th stock.
We combine these \term{stock fractions} $\stock_{t,j}$
in the vector $\vstock_t := (\stock_{t,1}, \dotsc, \stock_{t,m_{\stock}})$;
similarly, $\vbuysell_t := (\buysell_{t,1}, \dotsc, \buysell_{t,m_{\stock}})$.
Then, the consumption can be computed as a residual variable
(i.e., a variable that can be fully computed from $\state$ and $\policy$
and is thus omitted from $\policy$)
that is given by
\begin{equation}
  \consume_t
  := (1 - \sumfcn(\vstock_t)) \wealth_t - \bond_t -
  (1 + \tac) \sumfcn(\vbuy_t) + (1 - \tac) \sumfcn(\vsell_t),
\end{equation}
where $\sumfcn(\*a) := \tr{\*1} \*a$
is the sum of the entries of a vector $\*a$.
The state transition is computed by adding the returns of the stocks:
\begin{subequations}
  \begin{align}
    \wealth_{t+1}
    &:= \bond_t \bondreturn_t +
    %\sum_{j=1}^{m_{\stock}}
    %(\stock_{t,j} \wealth_t + \buy_{t,j} - \sell_{t,j}) \stockreturn_{t,j},\\
    \sumfcn(
      (\vstock_t \wealth_t + \vbuy_t - \vsell_t) \compmult \vstockreturn_t
    ),\\
    \vstock_{t+1}
    &:= \frac{
      (\vstock_t \wealth_t + \vbuy_t - \vsell_t) \compmult \vstockreturn_t
    }{\wealth_{t+1}}.
  \end{align}
\end{subequations}
where $\compmult$ is the component-wise multiplication,
$\bondreturn_t \in \real$ is the bond interest rate, and
$
  \vstockreturn_t
  = (\stockreturn_{t,1}, \dotsc, \stockreturn_{t,m_{\stock}})
  \in \real^{m_{\stock}}
$
is the vector of (stochastic) stock return rates.

\subsection{Normalization}
\label{sec:832normalized}

\paragraph{State transition}

The equations above can be normalized with respect to the wealth
$\wealth_t$:
By setting
$\normconsume_t  := \consume_t/\wealth_t$,
$\normbond_t     := \bond_t   /\wealth_t$, and
$\vnormbuysell_t := \vbuysell_t/\wealth_t$, we obtain
\begin{subequations}
  \label{eq:normalizedTCPStateTransition}
  \begin{align}
    \normconsume_t
    &:= (1 - \sumfcn(\vstock_t)) - \normbond_t -
    (1 + \tac) \sumfcn(\vnormbuy_t) + (1 - \tac) \sumfcn(\vnormsell_t),\\
    \wealthratio_{t+1}
    &:= \normbond_t \bondreturn_t +
    \sumfcn((\vstock_t + \vnormbuy_t - \vnormsell_t) \compmult \vstockreturn_t),
    \qquad(= \wealth_{t+1}/\wealth_t)\\
    \vstock_{t+1}
    &:= \frac{
      (\vstock_t + \vnormbuy_t - \vnormsell_t) \compmult \vstockreturn_t
    }{\wealthratio_{t+1}},
  \end{align}
\end{subequations}
where both $\normconsume_t$ and $\wealthratio_{t+1}$ are residual
variables that specify \term{normalized consumption} and
\term{wealth ratio,} respectively.
The resulting dynamic portfolio choice model has
the following variables:
\begin{itemize}
  \item
  $\centerhphantom{d}{m_{\stochastic}} = m_{\stock}$
  state variables $\normstate_t$:
  Stock fractions $\stock_{t,1}, \dotsc, \stock_{t,m_{\stock}}$
  
  \item
  $\centerhphantom{m_{\policy}}{m_{\stochastic}} = 2m_{\stock} + 1$
  policy variables $\normpolicy_t$:
  Normalized bonds $\normbond_t$,
  normalized buy amounts $\normbuy_{t,1}, \dotsc, \normbuy_{t,m_{\stock}}$ and
  normalized sell amounts $\normsell_{t,1}, \dotsc, \normsell_{t,m_{\stock}}$
  
  \item
  $m_{\stochastic} = m_{\stock}$
  stochastic variables $\stochastic_t$:
  Stock return rates $\stockreturn_{t,1}, \dotsc, \stockreturn_{t,m_{\stock}}$
\end{itemize}
The state space and policy space constraints are given by
\begin{subequations}
  \newcommand*{\centereqline}[1]{%
    \mathclap{\hphantom{\mathrm{(8.99a)}}#1}%
  }%
  \begin{gather}
    \centereqline{
      \vstock_t \ge \*0,\qquad
      \sumfcn(\vstock_t) \le 1,\qquad
      \normbond_t \ge 0,\qquad
      \vnormbuysell_t \ge \*0,\qquad
      \vnormsell_t \le \vstock_t,
    }\\
    \centereqline{
      \normconsume_{\min} + \normbond_t +
      (1 + \tac) \sumfcn(\vnormbuy_t) - (1 - \tac) \sumfcn(\vnormsell_t)
      \le 1 - \sumfcn(\vstock_t),
    }
  \end{gather}
\end{subequations}
where $\normconsume_{\min} \in \nonnegreal$ is some minimal consumption
that must be maintained.

\paragraph{Bellman equation}

Consequently, the Bellman equation \eqref{eq:gridBellmanCET}
after the certainty-equiva\-lent transformation has to be
normalized as well.
By setting $\normcetvalueintp_t(\state_t^{(k)})
:= \cetvalueintp_t(\state_t^{(k)})/\wealth_t$, we obtain
\begin{subequations}
  \begin{align}
    %\normcetvalueintp_t(\state_t^{(k)})
    %&= \frac{\cetvalueintp_t(\state_t^{(k)})}{\wealth_t}\\
    %&= \max_{\policy_t} \left(
    %  \left(
    %    \left(
    %      \frac{\consume_t(\state_t^{(k)}, \policy_t)}{\wealth_t}
    %    \right)^{1-\riskav} +
    %    \patience \expectation[t]{
    %      \left(
    %        \frac{
    %          \cetvalueintp_{t+1}(
    %            \statefcn_t(\state_t^{(k)}, \policy_t, \stochastic_t)
    %          )
    %        }{
    %          \wealth_t
    %        }
    %      \right)^{1-\riskav}
    %    }
    %  \right)^{1/(1-\riskav)}
    %\right)\\
    &\hphantom{=}\hspace{0.6em} \normcetvalueintp_t(\state_t^{(k)})\\
    &= \wealth_t^{-1} \cetvalueintp_t(\state_t^{(k)})\\
    &= \max_{\policy_t} \left(
      \left(
        \left(
          \wealth_t^{-1} \consume_t(\state_t^{(k)}, \policy_t)
        \right)^{1-\riskav} +
        \patience \expectation[t]{
          \left(
            \wealth_t^{-1} \cetvalueintp_{t+1}(
              \statefcn_t(\state_t^{(k)}, \policy_t, \stochastic_t)
            )
          \right)^{1-\riskav}
        }
      \right)^{1/(1-\riskav)}
    \right)\\
    &= \max_{\normpolicy_t} \left(
      \left(
        \normconsume_t(\state_t^{(k)}, \normpolicy_t)^{1-\riskav} +
        \patience \expectation[t]{
          \bigl(
            \wealthratio_{t+1} \normcetvalueintp_{t+1}(
              \normstatefcn_t(\state_t^{(k)}, \normpolicy_t, \stochastic_t)
            )
          \bigr)^{1-\riskav}
        }
      \right)^{1/(1-\riskav)}
    \right).
  \end{align}
\end{subequations}
This means that compared with the unnormalized Bellman equation
\eqref{eq:gridBellmanCET},
the value function in the expectation has to be multiplied by
the wealth ratio $\wealthratio_{t+1}$ introduced above in
\cref{eq:normalizedTCPStateTransition}.
Since there is no inheritance, the optimal terminal solution
is to sell all stocks and consume everything:
\begin{equation}
  \normcetvalueintp_t(\state_T^{(k)})
  = 1 - \tac \sumfcn(\vstock_t^{(k)}),\quad
  \normbond_T^{\opt}(\state_T^{(k)})
  = 0,\quad
  \vnormbuy[\opt]_T(\state_T^{(k)})
  = \*0,\quad
  \vnormsell[\opt]_T(\state_T^{(k)})
  = \vstock_t^{(k)}.
\end{equation}
