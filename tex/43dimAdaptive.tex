\section{Hierarchization on Dimensionally Adaptive Sparse Grids}
\label{sec:43dimAdaptive}

\blindtext{}



\subsection{Combination Technique and Combinatorial Proof}
\label{sec:431combiTechniqueProof}

\todo{mention Delvos/Schempp}

\todo{mention Wasilkowski}

\blindtext{}

\paragraph{Formal description and outline of a combinatorial proof}

In the following, we give a formal description of the
sparse grid combination technique and we outline a combinatorial proof
for its correctness.
We discuss a high-level explanation of the proofs in this section
The proofs themselves can be found in \cref{sec:proofCombiTechnique}
as most of them are rather technical.
For simplicity,
we formulate the combination technique and its proof for regular
sparse grids (see \cref{sec:231regularSG}).
However, the main ideas of the proof chain are also applicable
for dimensionally adaptive sparse grids
(see \cref{sec:232dimensionallyAdaptiveSG}).

\begin{theorem}[sparse grid combination technique]
  \label{thm:combiTechnique}
  Let $\liset := \{(\*l, \*i) \mid
  \normone{\*l} \le n,\; \*i \in \hiset{\*l}\}$
  correspond to the regular sparse grid
  $\regsgset{n}{d}{}$ and let $(\fcnval{\*l,\*i})_{(\*l,\*i) \in \liset}$
  be given function values on $\regsgset{n}{d}{}$.
  If we define
  \begin{itemize}
    \item
    the combined sparse grid interpolant $\regsgintp{n}{d}{\ct}$ via
    \eqref{eq:combiTechnique}, i.e.,
    \begin{equation}
      \regsgintp{n}{d}{\ct}
      = \sum_{q=0}^{d-1} (-1)^q \binom{d-1}{q} \sum_{\normone{\*l'} = n-q}
      \fgintp{\*l'},
    \end{equation}
    where $\fgintp{\*l'} \in \ns{\*l'}$ is the full grid interpolant
    of $\objfun$ with level $\*l'$, and
    
    \item
    the hierarchical sparse grid interpolant $\regsgintp{n}{d}{}$
    via \eqref{eq:hierarchizationProblem} and
    \eqref{eq:hierarchizationInterpolant}
  \end{itemize}
  and assume that the hierarchical splitting equation
  \eqref{eq:hierSplittingMV} holds,
  then the combined and the hierarchical sparse grid interpolants coincide:
  \begin{equation}
    \regsgintp{n}{d}{\ct}
    = \regsgintp{n}{d}{}.
  \end{equation}
\end{theorem}

\begin{proof}[Proof (sketch)]
  Let $\gp{\*l,\*i} \in \regsgset{n}{d}{}$ be an arbitrary
  point of the regular sparse grid.
  First, we split the inner sum of $\regsgintp{n}{d}{\ct}(\gp{\*l,\*i})$
  into levels $\*l'$ whose full grid sets $\fgset{\*l'}$
  contain $\gp{\*l,\*i}$ and levels whose full grid sets
  do not contain $\gp{\*l,\*i}$:
  \begin{subequations}
    \begin{align}
      \regsgintp{n}{d}{\ct}(\gp{\*l,\*i})
      &= \sum_{q=0}^{d-1} (-1)^q \binom{d-1}{q} \cdot \left(
      \sum_{\substack{\normone{\*l'} = n - q\\\fgset{\*l'} \ni \gp{\*l,\*i}}}
      \fgintp{\*l'}(\gp{\*l,\*i}) +
      \sum_{\substack{\normone{\*l'} = n - q\\\fgset{\*l'} \notni \gp{\*l,\*i}}}
      \fgintp{\*l'}(\gp{\*l,\*i})\right).\\
      \intertext{%
        The summands $\fgintp{\*l'}(\gp{\*l,\*i})$ of the first inner sum
        equal $\fcnval{\*l,\*i}$ due to full grid interpolation
        property \eqref{eq:interpFullGridMV}.
        Therefore, the first inner sum is equal to the product
        $\fcnval{\*l,\*i}$ with the number of summands:%
      }
      \label{eq:combiTechniqueSplitSum}
      \begin{split}
        &= \fcnval{\*l,\*i} \cdot \sum_{q=0}^{d-1} (-1)^q \binom{d-1}{q} \cdot
        \setsize{
          \{\*l' \mid \normone{\*l'} = n - q,\; \fgset{\*l'} \ni \gp{\*l,\*i}\}
        } +{}\\
        &\qquad\sum_{q=0}^{d-1} (-1)^q \binom{d-1}{q} \cdot
        \sum_{\substack{\normone{\*l'} = n - q\\\fgset{\*l'} \notni \gp{\*l,\*i}}}
        \fgintp{\*l'}(\gp{\*l,\*i}).
      \end{split}
    \end{align}
  \end{subequations}
  We will prove that the sum of the first $\sum$ sign
  equals one (see \cref{prop:combiTechniqueOne})
  and the sum of the second $\sum$ sign
  equals zero (see \cref{prop:combiTechniqueZero}).
  Consequently, we infer
  \begin{equation}
    \regsgintp{n}{d}{\ct}(\gp{\*l,\*i})
    = \fcnval{\*l,\*i},
  \end{equation}
  i.e., $\regsgintp{n}{d}{\ct}$ interpolates $f$ at $\regsgset{n}{d}{}$.
  Note that $\regsgintp{n}{d}{\ct}$ is contained in $\regsgspace{n}{d}{}$,
  if the hierarchical splitting equation \eqref{eq:hierSplittingMV} holds,
  as
  \begin{equation}
    \fgintp{\*l'} \in
    \ns{\*l'}
    = \bigoplus_{\*l''=\*0}^{\*l'} \hs{\*l''}
    \subset \regsgspace{n}{d}{},\quad
    \normone{\*l'} \le n,
  \end{equation}
  due to $\normone{\*l''} \le \normone{\*l'} \le n$
  for $\*l'' \le \*l'$.%
  \footnote{%
    This argumentation can be straightforwardly adapted
    for general dimensionally adaptive sparse grids
    with downward closed level sets as mentioned in
    \cref{sec:232dimensionallyAdaptiveSG}.%
  }
  As both $\regsgintp{n}{d}{\ct}$ and $\regsgintp{n}{d}{}$
  are contained in $\regsgspace{n}{d}{}$ and
  interpolate $f$ on $\regsgset{n}{d}{}$, they must coincide
  due to the uniqueness of sparse grid interpolation
  (linear independence of the hierarchical basis functions).
\end{proof}

\paragraph{Inclusion-exclusion principle}

It remains to prove that the first sum in \eqref{eq:combiTechniqueSplitSum}
is indeed one and that the second sum vanishes.
The first statement is a direct consequence of the so-called
\term{inclusion-exclusion principle}.
In its simplest form, the idea of the principle is that the cardinality
of the union of two finite subsets $A, B$ of some set is given by
\begin{equation}
  \setsize{A \cup B}
  = \setsize{A} + \setsize{B} - \setsize{A \cap B}.
\end{equation}
This equation states that we have to first count (include)
the elements in $A$ and then in $B$,
but as we have counted the elements of $A \cap B$ twice,
we have to subtract (exclude) its cardinality again.

The setting is similar for the combination technique.
If we add all grids in \cref{fig:combinationTechnique}
on the green diagonal, then every point whose index is not odd
will be counted multiple times.
By subtracting the number of occurrences of the points on the
red diagonal,
the result of the ``weighted counting'' is exactly one.
The following proposition, whose proof is of purely combinatorial nature,
generalizes this argument to higher dimensions:

\begin{restatable}[inclusion-exclusion principle]{%
  proposition%
}{%
  propCombiTechniqueOne%
}
  \label{prop:combiTechniqueOne}
  For every $\gp{\*l,\*i} \in \regsgset{n}{d}{}$, we have
  \begin{equation}
    \label{eq:combiTechniqueOne}
    \sum_{q=0}^{d-1} (-1)^q \binom{d-1}{q} \cdot
    \setsize{
      \{\*l' \mid \normone{\*l'} = n - q,\; \fgset{\*l'} \ni \gp{\*l,\*i}\}
    }
    = 1.
  \end{equation}
\end{restatable}

\begin{proof}
  See \cref{sec:proofCombiTechnique}.
\end{proof}

\paragraph{Canceling out function values}

The second statement about the vanishing second sum in
\eqref{eq:combiTechniqueSplitSum} is harder to prove.
It states that the contributions $\fgintp{\*l'}$ of levels $\*l'$
that do not contain a specific point $\gp{\*l,\*i}$ cancel out,
which may seem quite surprising.
The key observation is as follows:
The values of $\fgintp{\*l'}, \fgintp{\*l''}$ for two levels
$\*l', \*l''$ are the same at $\gp{\*l,\*i}$,
if the non-equal entries $l'_t, l''_t$ of the levels are
greater or equal to $l_t$.

For a higher-level explanation,
note that the statement $l'_t \ge l_t$ is equivalent to
$\gp{l_t,i_t} \in \fgset{l'_t}$.
%i.e., the projection of the grid point $\gp{\*l,\*i}$ onto the
%$t$-th dimension is contained in the projection of $\fgset{\*l'}$.
Both $\fgintp{\*l'}, \fgintp{\*l''}$ interpolate at
$\gp{\*l,\*i}$ when restricted to the pole of dimension $t$
through $\gp{\*l,\*i}$,
so their contribution to $\fgintp{\*l'}(\gp{\*l,\*i})$ and
$\fgintp{\*l''}(\gp{\*l,\*i})$ must be the same.
Although there may be dimensions $t$ for which
$\gp{l_t,i_t} \notin \fgset{l'_t}$,
these dimensions do not matter if $l'_t = l''_t$,
as the univariate restrictions of $\fgintp{\*l'}, \fgintp{\*l''}$
interpolate the same data and they are evaluated at the same point
$\gp{l_t,i_t}$.

Let us formalize these considerations by defining an
equivalence relation on the set of levels, such that the values of
$\fgintp{\*l'}$ at $\gp{\*l,\*i}$ are constant
on the equivalence classes.

\begin{definition}[relation ``$\sim$'']
  \label{def:combiTechniqueEquivalenceRelation}
  Let $\gp{\*l,\*i} \in \regsgset{n}{d}{}$ be fixed and
  \begin{equation}
    \label{eq:combiTechniqueSpecialLevelSet}
    \levelset
    := \{\*l' \mid \ex{q=0,\dotsc,d-1}{
      \normone{\*l'} = n - q,\; \fgset{\*l'} \notni \gp{\*l,\*i}
    }\}
  \end{equation}
  be the set of levels that do not contain $\gp{\*l,\*i}$.
  We define a relation ``$\sim$'' on $L$ as follows:
  For $\*l', \*l'' \in L$, we set $\*l' \sim \*l''$ if and only if
  \begin{equation}
    \fa{t \notin T_{\*l',\*l''}}{\min\{l'_t, l''_t\} \ge l_t},\quad
    T_{\*l',\*l''}
    := \{t \mid l'_t = l''_t\}.
  \end{equation}
\end{definition}

\begin{restatable}{%
  shortlemma%
}{%
  lemmaCombiTechniqueIdenticalValues%
}
  \label{lemma:combiTechniqueIdenticalValues}
  Let $\*l', \*l'' \in L$ with $\*l' \sim \*l''$.
  Then, $\fgintp{\*l'}(\gp{\*l,\*i})
  = \fgintp{\*l''}(\gp{\*l,\*i})$.
\end{restatable}

\begin{proof}
  See \cref{sec:proofCombiTechnique}.
\end{proof}

By exploiting on the tensor product structure of the basis functions,
the proof shows an even stronger version:
The components $\fgintp{\*l'}$ and $\fgintp{\*l''}$ are equal
on the $m$-dimensional subspace through $\gp{\*l,\*i}$
parallel to the $m$ coordinates in $T_{\*l',\*l''}$.
The lemma allows to group summands in the second sum of
\eqref{eq:combiTechniqueSplitSum} by function values.
Hence, it remains to count the number of levels for
each equivalence class of ``$\sim$''.
Therefore, we need a characterization of the structure
of the equivalence classes:

\begin{restatable}[characterization of the equivalence classes of ``$\sim$'']{%
  lemma%
}{%
  lemmaCombiTechniqueCharacterization%
}
  \label{lemma:combiTechniqueCharacterization}
  Let $L_0 \in \eqclasses{L}{\sim}$ be an equivalence class of ``$\sim$''.
  If we define
  \begin{equation}
    T_{L_0}
    := \{t \mid \exfa{l^\ast_t}{\*l' \in L_0}{l'_t = l^\ast_t}\}
  \end{equation}
  as the set of dimensions in which all levels in $L_0$
  have the same entry, then
  \begin{equation}
    L_0
    = \{\*l' \in L \mid
    \fa{t \in T_{L_0}}{l'_t = l^\ast_t},\;
    \fa{t \notin T_{L_0}}{l'_t \ge l_t}\}.
  \end{equation}
\end{restatable}

\begin{proof}
  See \cref{sec:proofCombiTechnique}.
\end{proof}

The lemma states that every equivalence class $L_0$ is exactly the
set of the levels whose entries are equal in some dimensions
(which are described with $T_{L_0}$)
and whose entries are greater or equal than $l_t$ in all the other dimensions.
While this statement may seem intuitively correct,
the proof is rather technical.
Finally, we are now able to show that the second sum in
\eqref{eq:combiTechniqueSplitSum} vanishes:

\begin{restatable}[function value cancellation]{%
  proposition%
}{%
  propCombiTechniqueZero%
}
  \label{prop:combiTechniqueZero}
  For every $\gp{\*l,\*i} \in \regsgset{n}{d}{}$, we have
  \begin{equation}
    \sum_{q=0}^{d-1} (-1)^q \binom{d-1}{q} \cdot
    \sum_{\substack{\normone{\*l'} = n - q\\\fgset{\*l'} \notni \gp{\*l,\*i}}}
    \fgintp{\*l'}(\gp{\*l,\*i})
    = 0.
  \end{equation}
\end{restatable}

\begin{proof}
  See \cref{sec:proofCombiTechnique}.
\end{proof}

The proof essentially first counts the number of possible levels in
an equivalence class and then applies known combinatorial identities
to prove that the sum must vanish.
This proves \thmref{thm:combiTechnique}.



\subsection{Hierarchization with the Combination Technique}
\label{sec:432hierarchizationCombiTechnique}

\blindtext{}

\subsection{%
  Hierarchization by Successive Applications of the Unidirectional Principle%
}
\label{sec:433hierarchizationSuccessiveUP}

\blindtext{}
