\section{Hierarchization on Full Grids (Unidirectional Principle)}
\label{sec:42fullGrids}

If $\sgset$ is a full grid $\fgset{\ßl}$
(see \cref{sec:21nodalSpaces}),
the well-known \emph{\up}
can be used to apply $\linop$ to input data $\vlinin$.
Its idea is to apply the corresponding one-dimensional operators on the
one-dimensional subgrids (the \emph{poles}) of $\sgset$,
which is repeated for all dimensions.
In this section, we first formulate the \up for
general linear operators $\linop$ and then prove its correctness for
the case $\linop = \intpmat^{-1}$ of hierarchization.
The correctness for the general case of arbitrary tensor product operators
will follow from the considerations in \cref{sec:444weaklyFundamentalSplines}.

\paragraph{Unidirectional principle and its correctness}

The \up is given in \cref{alg:unidirectionalPrinciple}.
The algorithm is given a permutation $(t_1, \dotsc, t_d)$ of $(1, \dotsc, d)$
that specifies the order of dimensions in which the \up should be applied.
We denote with $\linop_{t_j}$ the one-dimensional version of $\linop$
applied in dimension $t_j$ ($j = 1, \dotsc, d$).
With the following invariant, we can prove the correctness of the \up.

\begin{algorithm}
  \begin{algorithmic}[1]
    \Function{$\vlinout =$ unidirectionalPrinciple}{%
      $\liset$, $(t_1, \dotsc, t_d)$, $\vlinin$%
    }
      \State{$\vlinout^{(0)} \gets \vlinin$}
      \For{$j = 1, \dotsc, d$}
        \State{%
          Define equivalence relation $\sim$ on $\liset$
          as $\ßk \sim \ßk' \iff \ßk_{-t_j} = \ßk'_{-t_j}$%
        }
        \For{$\liset_\mathrm{pole} \in \liset/{\sim}$}
          \State{%
            $(\linout{\ßk}^{(j)})_{\ßk \in \liset_\mathrm{pole}} \gets
            \linop_{t_j}\Big[(\linout{\ßk}^{(j-1)})_{\ßk \in \liset_\mathrm{pole}}\Big]$%
          }
          \Comment{apply 1D operator on pole}%
          \label{line:algUnidirectionalPrinciple1}
        \EndFor{}
      \EndFor{}
      \State{$\vlinout \gets \vlinout^{(d)}$}
    \EndFunction{}
  \end{algorithmic}
  \caption{%
    Application of a tensor product operator $\linop$ with
    the unidirectional principle.
    Inputs are the set $\liset$ of grid indices,
    the permutation $(t_1, \dotsc, t_d)$ specifying the order in which
    the one-dimensional operators $\linop_{t_j}$ should be applied, and
    the vector $\vlinin = (\linin{\ßk})_{\ßk \in \liset}$ of input data.
    The output is the vector $\vlinout = (\linout{\ßk})_{\ßk \in \liset}$
    of output data.%
  }%
  \label{alg:unidirectionalPrinciple}%
\end{algorithm}

\begin{proposition}[%
  invariant of \cref{alg:unidirectionalPrinciple} for hierarchization%
]
  \label{prop:invariantUnidirectionalPrinciple}
  Let $\linop$ be the hierarchization operator on a full grid,
  i.e.,
  $\linop = \intpmat^{-1}$,
  $\vlinin = (\fcnval{\ßk})_{\ßk \in \liset}$,
  $\vlinout = (\surplus{\ßk})_{\ßk \in \liset}$,
  $\linop_{t_j}$ is the 1D interpolation operator $(\intpmat_{t_j})^{-1}$, and
  $\liset = \{\ß0, \dotsc, \ß2^\ßl\}$
  corresponds to a full grid $\fgset{\ßl}$ of level $\ßl$.
  After iteration $j$ of \cref{alg:unidirectionalPrinciple}
  ($j = 1, \dotsc, d$), it holds for $T := (t_1, \dotsc, t_j)$
  \begin{equation}
    \sum_{\ßk_T=\ß0}^{\ß2^{\ßl_T}}
    \alpha^{(j)}_{(\ßk_T,\ßk'_{-T})} \basis{\ßk_T}(\vgp{\ßk'_T})
    = \fcnval{\ßk'},\quad
    \ßk' = \ß0, \dotsc, \ß2^\ßl,
  \end{equation}
  where $(\ßk_T,\ßk'_{-T})$ is defined to be the index $\ßk''$
  with $\ßk''_T := \ßk_T$ and $\ßk''_{-T} := \ßk'_{-T}$.
\end{proposition}

\begin{proof}
  We prove the assertion by induction over $j = 1, \dotsc, d$.
  We set $T' := (t_1, \dotsc, t_{j-1})$,
  $T := (t_1, \dotsc, t_{j-1}, t_j)$,
  and we exploit the tensor product structure of the basis
  to write the \lhs of the assertion for $j$
  and arbitrary $\ßk' = \ß0, \dotsc, \ß2^\ßl$ as
  \begin{align}
    \sum_{\ßk_T=\ß0}^{\ß2^{\ßl_T}}
    \alpha^{(j)}_{(\ßk_T,\ßk'_{-T})} \basis{\ßk_T}(\vgp{\ßk'_T})
    &= \sum_{\ßk_{T'}=\ß0}^{\ß2^{\ßl_{T'}}}
    \basis{\ßk_{T'}}(\vgp{\ßk'_{T'}}) \cdot
    \sum_{k_{t_j}=0}^{2^{l_{t_j}}}
      \alpha^{(j)}_{(\ßk_T,\ßk'_{-T})} \basis{k_{t_j}}(\gp{k'_{t_j}}).\\
    \intertext{%
      If we choose the equivalence class
      $\liset_\mathrm{pole} := \clint{(\ßk_T,\ßk'_{-T})}_\sim$
      ($\ßk_T$ arbitrary, $\sim$ as defined in iteration $j$),
      then the sum over $k_{t_j}$ equals
      $\sum_{\ßk \in \liset_\mathrm{pole}}
      \alpha^{(j)}_\ßk \basis{k_{t_j}}(\gp{k'_{t_j}})
      %= ((\linop_{t_j})^{-1}
      %\Big[(\surplus{\ßk}^{(j)})_{\ßk \in \liset_\mathrm{pole}}\Big])_{k'_{t_j}}
      %= ((\surplus{\ßk}^{(j-1)})_{\ßk \in \liset_\mathrm{pole}})_{k'_{t_j}}
      = \alpha^{(j-1)}_{(\ßk_{T'},\ßk'_{-T'})}$
      by the 1D interpolation operator $T_{t_j}$
      (\cref{line:algUnidirectionalPrinciple1} of
      \cref{alg:unidirectionalPrinciple}).
      We can conclude that the \lhs equals%
    }
    &= \sum_{\ßk_{T'}=\ß0}^{\ß2^{\ßl_{T'}}}
    \alpha^{(j-1)}_{(\ßk_{T'},\ßk'_{-T'})}
    \basis{\ßk_{T'}}(\vgp{\ßk'_{T'}}),
  \end{align}
  which, by the induction hypothesis, equals $\fcnval{\ßk'}$ as desired
  (if $j > 1$).
  The same reasoning for $(\ast\ast)$ can be used
  to establish the base case for $j = 1$.
\end{proof}

\begin{shortcorollary}
  \Cref{alg:unidirectionalPrinciple}
  is correct for hierarchization on full grids.
\end{shortcorollary}

\begin{proof}
  We apply \cref{prop:invariantUnidirectionalPrinciple} to obtain
  $\sum_{\ßk=\ß0}^{\ß2^\ßl}
  \alpha^{(j)}_\ßk \basis{\ßk}(\vgp{\ßk'})
  = \fcnval{\ßk'}$
  for all $\ßk' = \ß0, \dotsc, \ß2^\ßl$, i.e.,
  the $\alpha^{(j)}_\ßk$ are the correct interpolation coefficients
  according to \eqref{eq:hierarchizationProblem}.
\end{proof}

\paragraph{Complexity}

We compare the complexity of the \up for hierarchization compared
to directly solving the system \eqref{eq:hierarchizationSLE} of
linear equations.
If we assume that $\linop$ and $\linop_{t_j}$ apply Gaussian elimination to
solve the multivariate and univariate systems, respectively,
then directly solving \eqref{eq:hierarchizationSLE} takes
$\landauO{\ngp^3 d}$ time (in 1D basis evaluations) and $\landauO{\ngp^2}$ memory.
In contrast, the unidirectional principle only

\blindtext{}
