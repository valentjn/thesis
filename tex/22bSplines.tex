\section{Defining Hierarchical B-Splines}
\label{sec:22bSplines}

\todo{add references}

B-spline basis functions generalize the well-known hat functions.
The first to study B-splines was Schoenberg in 1946,
but he claimed that they had already been known to Laplace.
\newgacronym{fem}{FEM}{Finite element method}%
The possibilities of B-splines were recognized when
the finite element method (\fem),
which is still one of the most important applications of B-splines,
emerged in the 1960s.
The most groundwork like finding basic algorithms and proving fundamental
theoretic results was done by de Boor.
B-splines have been applied in various fields:
\fem,
geometric modeling with non-uniform rational B-splines (NURBS),
financial mathematics,
molecular and atomic physics,
and other scientific and industrial areas.

In this section, we mainly follow the presentation of
\cite{Valentin16Hierarchical} to define hierarchical B-splines.
Thanks to the groundwork laid in \cref{sec:21sparseGrids},
it suffices to study the univariate case.
The multivariate case is as usual treated by the tensor product approach.

\subsection{Uniform Hierarchical B-Splines}

\todo{add references}

The \term{cardinal B-spline}
$b^p\colon \RR \to \RR$ of \term{degree} $p \in \NN_0$
is defined by the recursion
\begin{equation}
  \label{eq:cardinalBSpline}
  b^p(x)
  :=
  \begin{cases}
    \displaystyle\int_0^1 b^{p-1}(x - y) \diff{}y,&p \ge 1,\\
    \chi_{\halfopeninterval{0, 1}}(x),&p = 0,
  \end{cases}
\end{equation}
where $\chi_{\halfopeninterval{0, 1}}$ is the characteristic function of
the half-open unit interval $\halfopeninterval{0, 1}$.
The definition implies the following properties of $b^p$:
\begin{itemize}
  \item
  \emph{Support:}
  The support of $b^p$ is given by $\supp b^p = [0, p + 1]$.
  
  \item
  \emph{Bounds and symmetry:}
  The cardinal B-spline $b^p$ is non-negative and bounded from above by $1$.
  It is symmetric with respect to the center of its support, i.e.,
  $b^p(x) = b^p(p + 1 - x)$.
  
  \item
  \emph{Spline:}
  On every \term{knot interval} $\halfopeninterval{k, k+1}$
  ($k = 0, \dotsc, p$), $b^p$ is a polynomial of degree~$p$, i.e.,
  $b^p$ is a spline (piecewise polynomial).
  
  \item
  \emph{Differentiability:}
  At the \term{knots} $k = 0, \dotsc, p + 1$,
  $b^p$ is $(p - 1)$ times continuously differentiable.
  The derivative can be computed by differentiating
  \eqref{eq:cardinalBSpline}:
  \begin{equation}
    \label{eq:cardinalBSplineDerivative}
    \frac{\diff}{\dx} b^p(x)
    = b^{p-1}(x) - b^{p-1}(x-1).
  \end{equation}
  
  \item
  \emph{Convolution:}
  The integral in the definition of $b^p$
  is the convolution $b^{p-1} \ast b^0$ of the B-spline $b^{p-1}$
  of degree $p - 1$ with the B-spline $b^0$ of degree $0$.
  
  \item
  \emph{Generalization:}
  As a special case, $b^1$ is a hat function interpolating the data
  $\{(k, \delta_{k,1}) \mid k \in \ZZ\}$.
  One can show that for the limit of $p \to \infty$,
  $b^p$ converges to the Gaussian bell curve function
  $b^\infty(x) := (2\pi)^{-1/2} \exp(-x^2/2)$.
  \todo{check, more exact}
\end{itemize}

We can use the cardinal B-spline $b^p$ as a ``mother function'' to
define the uniform hierarchical B-spline
$\varphi_{l,i}^p\colon [0, 1] \to \RR$ of level $l \in \NN_0$ and index
$i \in I_l$ via an affine parameter transformation:
\todo{citation [28] in SGA?}
\begin{equation}
  \label{eq:uniformHierarchicalBSplineUV}
  \varphi_{l,i}^p(x)
  := b^p(x/h_l + (p+1)/2 - i).
\end{equation}
The support of $\varphi_{l,i}^p$ is given
by $\supp \varphi_{l,i}^p = [0, 1] \cap (h_l \cdot [i \pm (p+1)/2])$,
where $[i \pm (p+1)/2] := [i - (p+1)/2, i + (p+1)/2]$.
The hat function basis $\varphi_{l,i}^1$ defined in
\eqref{eq:hatFunctionUV} is a special case of
\cref{eq:uniformHierarchicalBSplineUV} for $p = 1$,
which allows us to use the same notation $\varphi_{l,i}^p$ for both.

In the following, we will only allow odd degrees $p = 1, 3, 5, \dotsc$
in this thesis.
Many theoretical considerations will not hold for even degrees.
The basic reason is that for odd degrees, the knots of
$\varphi_{l,i}^p$ coincide with the grid points
\begin{equation}
  x_{l,i-(p+1)/2},\quad
  \dotsc,\quad
  x_{l,i},\quad
  \dotsc,\quad
  x_{l,i+(p+1)/2}.
\end{equation}
For even degrees $p$, the knots of $\varphi_{l,i}^p$ lie exactly in
the middle between two subsequent grid points:
\begin{equation}
  x_{l,i-p/2} - \frac{h_l}{2},\quad
  \dotsc,\quad
  x_{l,i} - \frac{h_l}{2},\quad
  x_{l,i} + \frac{h_l}{2},\quad
  \dotsc,\quad
  x_{l,i+p/2} + \frac{h_l}{2}.
\end{equation}
For the theory of hierarchical functions,
this would have many severe implications,
which we will discuss later
when we make the respective considerations.

\subsection{Non-Uniform B-Splines and Proof of the Hierarchical Splitting}

With the hierarchical B-splines $\varphi_{l,i}^p$, we can define
the nodal spaces $V_l^p$ and hierarchical subspaces $W_l^p$
as in \cref{sec:21sparseGrids}.
However, in order for the hierarchical splitting \eqref{eq:hierSplittingUV}
to be correct, we have to prove that the conditions of
\cref{lemma:hierSplittingUV} are satisfied.
To investigate how the nodal space $V_l^p$ looks like,
we introduce the notion of non-uniform B-splines.

\begin{definition}[Non-uniform B-splines]
  Let $m, p \in \NN_0$ and $\ß\xi = (\xi_0, \dotsc, \xi_{m+p})$ be an
  increasing sequence of real numbers \term{(knot sequence)}.
  For $k = 0, \dotsc, m - 1$,
  the \term{(non-uniform) B-spline} $b_{k,\ß\xi}^p$ of degree $p$
  with knots $\ß\xi$ and index $k$ is defined by the
  Cox--de Boor recurrence
  \cite{Cox72Numerical,Boor72Calculating,Hoellig13Approximation}
  \begin{equation}
    b_{k,\ß\xi}^p(x)
    :=
    \begin{cases}
      \dfrac{x - \xi_k}{\xi_{k+p} - \xi_k} b_{k,\ß\xi}^{p-1}(x) +
      \dfrac{\xi_{k+p+1} - x}{\xi_{k+p+1} - \xi_{k+1}}
      b_{k+1,\ß\xi}^{p-1}(x),&p \ge 1,\\
      \chi_{\halfopeninterval{\xi_k, \xi_{k+1}}}(x),&p = 0.
    \end{cases}
  \end{equation}
\end{definition}
Note that when choosing $\ß\xi = (0, 1, \dotsc, p + 1)$ and
$k = 0$, we obtain the cardinal B-spline $b^p$.
The definition can be used to characterize the nodal space $V_l^p$:

\begin{proposition}[Spline space]
  \label{prop:splineSpace}
  Let $\ß\xi = (\xi_0, \dotsc, \xi_{m+p})$ be a knot sequence.
  Then, the B-splines $b_{k,\ß\xi}^p$ ($k = 0, \dotsc, m - 1$)
  form a basis of the \term{spline space}
  \begin{equation}
    S_\ß\xi^p
    := \spn\{b_{k,\ß\xi}^p \mid k = 0, \dotsc, m - 1\}.
  \end{equation}
  $S_\ß\xi^p$ contains exactly those functions which are continuous
  on $D_\ß\xi^p := [\xi_p, \xi_m]$,
  polynomials of degree $\le p$ on every knot interval
  $[\xi_k, \xi_{k+1}]$ \todo{check half-open interval?} in $D_\ß\xi$
  ($k = p, \dotsc, m - 1$) and at least $(p - 1)$ times
  continuously differentiable at every knot $\xi_k$ in the interior of
  $D_\ß\xi^p$ ($k = p + 1, \dotsc, m - 1$).
\end{proposition}

\begin{proof}
  See \cite{Hoellig13Approximation}.
\end{proof}

\begin{corollary}[Nodal B-spline space]
  \label{cor:nodalBSplineSpace}
  The nodal B-splines $\varphi_{l,i}^p$ ($i = 0, \dotsc, 2^l$)
  of level $l \in \NN_0$ are
  a basis of the spline space $S_\ß\xi^p$
  \begin{equation}
    \xi_k
    := (k - (p+1)/2) h_l,\quad
    k = 0, \dotsc, m + p,\quad
    m := 2^l + 1,
  \end{equation}
  and
  \begin{equation}
    V_l^p|_{D_l^p} = S_\ß\xi^p,\quad
    D_l^p := \left[h_l \frac{p-1}{2},\; 1 - h_l \frac{p-1}{2}\right],
  \end{equation}
  where $V_l^p|_{D_l^p} := \{f_l|_{D_l^p} \mid f_l \in V_l^p\}$
  is the nodal space restricted to $D_l^p$.
\end{corollary}

\begin{proof}
  We have $\varphi_{l,i}^p = b_{i,\ß\xi}^p$ for
  $i = 0, \dotsc, m - 1$,
  as the B-splines on both sides have the same knots.
  The assertions now follow from \cref{prop:splineSpace}.
\end{proof}

Note that $D_l^p$ might contain only a single point or even be empty,
if $p$ is too large or $l$ is too small.
However, the corresponding B-splines $\varphi_{l,i}^p$ are still linearly
independent on $[0, 1]$ (see \cite{Hoellig13Approximation}).
Similarly, the corollary also implies that the hierarchical functions
$\varphi_{l,i}^p$ ($i \in I_l$) are linearly independent on $[0, 1]$.

\begin{lemma}[First condition of \cref{lemma:hierSplittingUV}]
  The restricted hierarchical subspaces
  $W_{l'}^p|_{D_l^p}$ ($l' \le l$) are
  subspaces of the restricted nodal space $V_l^p|_{D_l^p}$.
\end{lemma}

\begin{proof}
  Every function $\varphi_{l',i'}^p$ ($i' \in I_{l'}$) is continuous on
  $D_l^p$, a polynomial of degree $\le p$ on every knot interval
  of $\ß\xi$ as defined in \cref{cor:nodalBSplineSpace},
  and at the knots themselves at least $(p - 1)$ times continuously
  differentiable.
  \Cref{prop:splineSpace} implies $\varphi_{l',i'}^p \in S_\ß\xi^p$
  and from \cref{cor:nodalBSplineSpace}, it follows
  $\varphi_{l',i'}^p \in V_l^p|_{D_l^p}$.
  As the functions $\varphi_{l',i'}^p$ ($i' \in I_{l'}$) span
  $W_{l'}^p|_{D_l^p}$, we can conclude
  $W_{l'}^p|_{D_l^p} \subset V_l^p|_{D_l^p}$.
\end{proof}

\begin{restatable}[Second condition of \cref{lemma:hierSplittingUV}]{%
  proposition%
}{%
  propHierBSplineLinearlyIndependent%
}
  \label{prop:hierBSplineLinearlyIndependent}
  \label{PROP:HIERBSPLINELINEARLYINDEPENDENT}
  The restricted hierarchical B-splines
  $\varphi_{l',i'}^p|_{D_l^p}$ ($l' \le l$, $i' \in I_{l'}$)
  are linearly independent.
\end{restatable}

\begin{proof}
  See \cref{sec:proofHierBSplineLinearlyIndependent}.
\end{proof}

Although we have to restrict all functions and spaces to $D_l^p$,
\cref{lemma:hierSplittingUV} is still applicable to prove that
the hierarchical splitting equation \eqref{eq:hierSplittingUV}
is correct for hierarchical B-splines:

\begin{corollary}
  The hierarchical splitting \eqref{eq:hierSplittingUV}
  holds for the hierarchical B-spline basis
  if restricting all functions to $D_l^p$:
  \begin{equation}
    V_l|_{D_l^p}
    = \bigoplus_{l'=0}^l W_{l'}|_{D_l^p}.
  \end{equation}
\end{corollary}

\begin{proof}
  Analogously to the proof of \cref{lemma:hierSplittingUV}.
\end{proof}

\subsection{Modification}

\todo{write}










































\blindtext{}

\subsection{Non-Uniform Hierarchical B-Splines}

\todo{write}

\blindtext{}
